name: Deploy Frontend to Render

on:
  push:
    branches:
      - main
    paths:
      - 'frontend/**'
      - '.github/workflows/deploy-frontend.yml'

jobs:
  trigger-deploy:
    name: Trigger Render frontend deploy
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Trigger Render deploy (frontend)
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID: ${{ secrets.RENDER_FRONTEND_SERVICE_ID }}
        run: |
          echo "Calling Render API to create a new deploy for service $RENDER_SERVICE_ID"
          resp=$(curl -s -o /tmp/render_resp.json -w "%{http_code}" \
            -X POST \
            -H "Accept: application/json" \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            "https://api.render.com/v1/services/$RENDER_SERVICE_ID/deploys")
          code=$?
          http_code=$(cat /tmp/render_resp.json | jq -r '.status' 2>/dev/null || echo "$resp")
          echo "curl exit code: $code"
          echo "Render response (first 400 chars):"
          head -c 400 /tmp/render_resp.json || true
          if [ "$resp" != "200" ] && [ "$resp" != "201" ] && [ -z "$http_code" ]; then
            echo "Warning: unexpected response; showing /tmp/render_resp.json contents:"
            cat /tmp/render_resp.json || true
          fi
